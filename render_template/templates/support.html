<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Dashboard - ZestPay</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #f4f6f9, #eef1f7);
      color: #222;
    }

    /* Header */
    .top {
      background: linear-gradient(135deg, #111, #222);
      color: #fff;
      padding: 16px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      position: sticky; top: 0; z-index: 10;
      flex-wrap: wrap; /* Allow wrapping on smaller screens */
    }
    .top strong { font-size: 22px; letter-spacing: 1px; color: #00c853; }
    nav {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    nav a {
      color: #fff; 
      text-decoration: none;
      font-weight: 500; 
      font-size: 15px; 
      display: inline-flex;
      align-items: center; 
      transition: color 0.3s;
    }
    nav a i { margin-right: 6px; }
    nav a:hover { color: #00c853; }

    /* Container */
    .container { padding: 30px; max-width: 1200px; margin: 0 auto; }
    .grid { display: grid; grid-template-columns: 1fr 320px; gap: 22px; }

    /* Card */
    .card {
      background: #fff;
      padding: 22px;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      margin-bottom: 20px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 28px rgba(0,0,0,0.12);
    }
    .card h3, .card h4 {
      margin: 0 0 14px;
      font-weight: 600; color: #333;
      border-bottom: 1px solid #eee; padding-bottom: 8px;
      display: flex; align-items: center; font-size: 18px;
    }
    .card h3 i, .card h4 i { margin-right: 8px; color: #00c853; }

    /* Buttons */
    .btn {
      padding: 9px 16px; background: #00c853; color: #fff;
      border-radius: 8px; text-decoration: none; font-weight: 600;
      transition: background 0.3s, transform 0.2s; cursor: pointer;
    }
    .btn:hover { background: #009c3d; transform: scale(1.05); }

    /* Modal */
    .modal {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6); display: flex;
      justify-content: center; align-items: center;
      visibility: hidden; opacity: 0; transition: 0.3s;
      z-index: 1000;
    }
    .modal.show { visibility: visible; opacity: 1; }
    .modal-content {
      background: #fff; padding: 30px; border-radius: 12px;
      text-align: center; max-width: 320px; width: 90%;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    .modal-content h3 { margin: 0 0 10px; }
    .modal-content p { margin-bottom: 15px; }
    .modal-content .btn { margin: 6px; }

    /* ZestPay Loader */
    .loading {
      display: flex; justify-content: center; gap: 4px; margin-bottom: 15px;
    }
    .loading span {
      display:inline-block;
      font-size: 26px;
      font-weight:bold;
      color:#00c853;
      animation: bounce 1.2s infinite;
    }
    .loading span:nth-child(2){animation-delay:0.2s;}
    .loading span:nth-child(3){animation-delay:0.4s;}
    .loading span:nth-child(4){animation-delay:0.6s;}
    .loading span:nth-child(5){animation-delay:0.8s;}
    .loading span:nth-child(6){animation-delay:1s;}
    .loading span:nth-child(7){animation-delay:1.2s;}
    @keyframes bounce {
      0%,80%,100%{transform:scale(0.8);opacity:0.5;}
      40%{transform:scale(1.3);opacity:1;}
    }

    /* Global full-screen loader */
    #globalLoader {
      position: fixed; top:0; left:0; right:0; bottom:0;
      background: rgba(255,255,255,0.9);
      display: flex; justify-content: center; align-items: center;
      visibility: hidden; opacity: 0; transition: 0.3s;
      z-index: 2000;
    }
    #globalLoader.show { visibility: visible; opacity: 1; }

    /* Responsive Design */
    @media (max-width: 992px) {
      .grid { grid-template-columns: 1fr; }
      .top { flex-direction: column; align-items: flex-start; gap: 10px; }
      nav a { margin-left: 0; }
    }
    @media (max-width: 600px) {
      .top strong { font-size: 20px; }
      nav a { font-size: 14px; }
      .card { padding: 16px; border-radius: 10px; }
      .modal-content { padding: 20px; max-width: 90%; }
    }

























    /* AI Chat Widget Styles */
/* AI Chat Widget Styles */
#aiWidget {
  font-family: 'Segoe UI', Arial, sans-serif;
  box-shadow: 0 4px 16px rgba(0,0,0,0.25);
  border-radius: 12px;
  overflow: hidden;
  transition: transform 0.3s ease;
}
#aiWidget:hover { transform: translateY(-3px); }
#aiHeader {
  background: #00c853;
  color: #fff;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 16px;
  font-weight: 600;
  padding: 10px;
  cursor: pointer;
}
#aiChat {
  display: none;
  flex-direction: column;
  background: #fff;
  border-top: 2px solid #00c853;
  max-height: 400px;
  overflow: hidden;
  border-radius: 0 0 12px 12px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}
#messages {
  max-height: 320px;
  overflow-y: auto;
  padding: 10px;
}
#messages p { margin: 6px 0; line-height: 1.4; }
#messages p strong { color: #00c853; }
#aiInput {
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 8px;
  flex: 1;
  font-size: 14px;
  outline: none;
  transition: border 0.3s;
}
#aiInput:focus { border-color: #00c853; }
#aiSend {
  background: #00c853;
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 8px 12px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.3s, transform 0.2s;
}
#aiSend:hover { background: #009c3d; transform: scale(1.05); }

/* Scrollbar styling */
#messages::-webkit-scrollbar { width: 6px; }
#messages::-webkit-scrollbar-thumb { background-color: #00c853; border-radius: 3px; }
#messages::-webkit-scrollbar-track { background: #f1f1f1; }

/* Responsive */
@media (max-width: 600px) {
  #aiWidget { width: 90%; bottom: 10px; right: 5%; }
  #aiInput { font-size: 13px; }
  #aiSend { padding: 7px 10px; font-size: 13px; }
  #aiHeader { font-size: 14px; }
}


  </style>
</head>
<body>
  <!-- Top bar -->
  <div class="top">
    <div><strong><i class="fa-solid fa-bolt"></i> ZestPay</strong></div>
    <nav>
      <a href="/profile"><i class="fa-solid fa-user"></i> Profile</a>
      <a href="/settings"><i class="fa-solid fa-gear"></i> Settings</a>
      <a href="/rates"><i class="fa-solid fa-chart-line"></i> Rates</a>
      <a href="/cards"><i class="fa-solid fa-credit-card"></i> Cards</a>
      <a href="#" id="logoutBtn"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
    </nav>
  </div>

  <!-- Main container -->
  <div class="container">
    <h2 id="welcome" style="color:#333; margin-bottom:20px;">Welcome</h2>
    <div class="grid">
      <!-- Left side -->
      <div>
        <div class="card">
          <h3><i class="fa-solid fa-id-card"></i> Account</h3>
          <div id="accountInfo" class="profile-box">
            <p>Loading profile...</p>
          </div>
        </div>

        <div class="card">
          <h3><i class="fa-solid fa-chart-line"></i> Rates</h3>
          <p>üìä Coming soon ‚Äî live rates & charts will appear here.</p>
        </div>

        <div class="card">
          <h3><i class="fa-solid fa-credit-card"></i> Cards</h3>
          <p>üí≥ Coming soon ‚Äî card management UI.</p>
        </div>
      </div>

      <!-- Right side -->
      <div>
        <div class="card">
          <h4><i class="fa-solid fa-bolt"></i> Quick actions</h4>
          <p><a href="/settings">‚öôÔ∏è Edit Profile</a></p>
          <p><a href="/rates">üìà View Rates</a></p>
        </div>

        <div class="card">
          <h4><i class="fa-solid fa-user-circle"></i> Profile Summary</h4>
          <div id="profileSummary">Loading...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Logout Modal -->
  <div id="logoutModal" class="modal">
    <div class="modal-content" id="modalContent">
      <h3>Logout</h3>
      <p>Are you sure you want to logout?</p>
      <button class="btn" onclick="confirmLogout()">Yes</button>
      <button class="btn" style="background:#777;" onclick="closeModal()">Cancel</button>
    </div>
  </div>

  <!-- Global Loader -->
  <div id="globalLoader">
    <div class="loading">
      <span>Z</span><span>E</span><span>S</span><span>T</span><span>P</span><span>A</span><span>Y</span>
    </div>
  </div>

  <!-- No Internet Modal -->
  <div id="offlineModal" class="modal">
    <div class="modal-content">
      <h3 style="color:red;"><i class="fa-solid fa-wifi"></i> No Internet</h3>
      <p>Please check your data connection to continue.</p>
      <button class="btn" onclick="closeOffline()">OK</button>
    </div>
  </div>







<!-- AI Chat Widget -->
<div id="aiWidget" style="position: fixed; bottom: 20px; right: 20px; width: 350px; max-width: 90%; z-index: 3000;">
  <div id="aiHeader">
    <i class="fa-solid fa-robot"></i> ZestPay AI Assistant
  </div>
  <div id="aiChat">
    <div id="messages"></div>
    <div style="display:flex;gap:6px;padding:10px;">
      <input id="aiInput" type="text" placeholder="Ask me anything..." />
      <button id="aiSend" class="btn">Send</button>
    </div>
  </div>
</div>
















<script>
  async function loadProfile(){
    const res = await fetch('/api/profile');
    if(res.status === 401){ window.location.href = '/login'; return; }
    const j = await res.json();
    if(j.status !== 'ok'){ 
      document.getElementById('accountInfo').innerText = 'Could not load profile';
      return;
    }
    const p = j.profile;
    const name = (p.firstName || p.email).trim();
    document.getElementById('welcome').textContent = 'Welcome, ' + name;
    document.getElementById('accountInfo').innerHTML = `
      <p><strong>Name:</strong> ${p.firstName || '-'} ${p.lastName || ''}</p>
      <p><strong>Email:</strong> ${p.email}</p>
      <p><strong>Phone:</strong> ${p.phone || '-'}</p>
      <p><strong>Referral:</strong> ${p.referral || '-'}</p>
    `;
    document.getElementById('profileSummary').innerHTML = `
      <p><strong>${p.firstName || p.email}</strong></p>
      <p>${p.email}</p>
    `;
  }
  loadProfile();

  // Logout modal
  const logoutBtn = document.getElementById("logoutBtn");
  const logoutModal = document.getElementById("logoutModal");
  const modalContent = document.getElementById("modalContent");

  logoutBtn.addEventListener("click", e => {
    e.preventDefault();
    if(!navigator.onLine){
      showOffline();
      return;
    }
    logoutModal.classList.add("show");
  });

  function closeModal(){
    logoutModal.classList.remove("show");
  }

  function confirmLogout(){
    modalContent.innerHTML = `
      <div class="loading">
        <span>Z</span><span>E</span><span>S</span><span>T</span><span>P</span><span>A</span><span>Y</span>
      </div>
      <p style="color:#555;">Logging you out...</p>
    `;
    setTimeout(() => {
      window.location.href = "/login";
    }, 2500);
  }

  // Global loader for all clicks
  const globalLoader = document.getElementById("globalLoader");
  document.querySelectorAll("a, .btn").forEach(el => {
    el.addEventListener("click", function(e){
      const href = el.getAttribute("href");
      if(href && href !== "#" && !el.id.includes("logoutBtn")){
        if(!navigator.onLine){
          e.preventDefault();
          showOffline();
          return;
        }
        e.preventDefault();
        globalLoader.classList.add("show");
        setTimeout(() => { window.location.href = href; }, 2000);
      }
    });
  });

  // Offline modal
  const offlineModal = document.getElementById("offlineModal");
  function showOffline(){
    offlineModal.classList.add("show");
  }
  function closeOffline(){
    offlineModal.classList.remove("show");
  }






const aiHeader = document.getElementById("aiHeader");
const aiChat = document.getElementById("aiChat");
const messagesDiv = document.getElementById("messages");
const aiInput = document.getElementById("aiInput");
const aiSend = document.getElementById("aiSend");

// Toggle AI chat window
aiHeader.addEventListener("click", () => {
  aiChat.style.display = aiChat.style.display === "block" ? "none" : "block";
});

// Append message (user or AI)
function appendMessage(sender, text, isUser=false){
  const msg = document.createElement("div");
  msg.classList.add("msg");
  msg.innerHTML = `<p><strong>${sender}:</strong> ${text}</p>`;
  
  // If it's user, add a small "seen" placeholder
  if(isUser){
    const seenTag = document.createElement("span");
    seenTag.classList.add("seenTag");
    seenTag.style.cssText = "font-size:12px;color:green;display:none;margin-left:6px;";
    seenTag.textContent = "Seen";
    msg.appendChild(seenTag);
  }

  messagesDiv.appendChild(msg);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
  return msg; // return element so we can update later
}

// Send message to backend AI
async function sendAIMessage(message){
  // ‚úÖ Check internet before sending
  if (!navigator.onLine) {
    appendMessage("AI", "No internet connection. Please reconnect to continue.");
    showOffline();
    return;
  }

  // Show user message (with hidden seen tag)
  const userMsg = appendMessage("You", message, true);

  // Show AI typing
  const typingMsg = document.createElement("p");
  typingMsg.innerHTML = `<strong>AI:</strong> <em>Typing...</em>`;
  messagesDiv.appendChild(typingMsg);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;

  try {
    const res = await fetch("/api/ai", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt: message })
    });

    const data = await res.json();

    // Replace typing with AI response
    if(data.action === "redirect" && data.redirect_url){
      typingMsg.innerHTML = `<strong>AI:</strong> ${data.reply}`;
      setTimeout(() => { window.location.href = data.redirect_url; }, 1500);
    }
    else if(data.action === "message"){
      typingMsg.innerHTML = `<strong>AI:</strong> ${data.reply}`;
    }
    else if(data.error){
      typingMsg.innerHTML = `<strong>AI:</strong> <em>${data.error}</em>`;
    }
    else {
      typingMsg.innerHTML = `<strong>AI:</strong> <em>Sorry, unexpected response.</em>`;
    }

    // ‚úÖ Mark user message as seen
    const seenTag = userMsg.querySelector(".seenTag");
    if(seenTag) seenTag.style.display = "inline";

    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  } catch (err) {
    typingMsg.innerHTML = `<strong>AI:</strong> <em>Ask Related Question On Zestpay</em>`;
  }
}

// Event listeners
aiSend.addEventListener("click", () => {
  const msg = aiInput.value.trim();
  if(msg){ sendAIMessage(msg); aiInput.value = ""; }
});
aiInput.addEventListener("keypress", e => { if(e.key === "Enter") aiSend.click(); });
</script>

</body>
</html>
