<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZestPay Registration</title>
<style>
  body {
    margin:0; padding:0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #000, #111);
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }
  .container {
    background: rgba(0,0,0,0.7);
    padding: 30px;
    border-radius: 12px;
    width: 100%;
    max-width: 400px;
    box-shadow: 0 0 20px rgba(0,255,100,0.4);
    position: relative;
  }
  h2 { text-align:center; margin-bottom:15px; }
  p { text-align:center; font-size:14px; margin-bottom:20px; }
  input {
    width: 100%; padding:10px; margin:10px 0;
    border-radius:6px; border:none;
    background:#222; color:#fff;
  }
  input:focus { outline:none; box-shadow:0 0 8px #00c853; }
  .btn {
    width: 100%; padding:12px; margin-top:10px;
    border:none; border-radius:6px; cursor:pointer;
    font-weight:700;
    background: linear-gradient(90deg,#00c853,#19a24c);
    color:#000; transition:0.3s;
  }
  .btn:hover { transform:scale(1.05); }
  .btn-secondary {
    background:#444; color:#fff; margin-top:10px;
  }
  .toggle-eye { cursor:pointer; position:absolute; right:15px; top:12px; color:#fff; }
  .input-container { position: relative; }
  .password-strength {
    height:6px; width:100%; background:#333;
    border-radius:3px; margin-top:-6px; margin-bottom:10px;
    overflow:hidden;
  }
  .strength-bar {
    height:100%; width:0%; background:red;
    transition: width 0.3s;
  }
  .hidden { display:none; }
  .login-link { color:#00c853; cursor:pointer; text-align:center; margin-top:5px; display:block; }
  .message { padding:10px; margin:10px 0; border-radius:6px; text-align:center; font-size:14px; }
  .error-msg { background:#ff4c4c; color:#fff; }
  .success-msg { background:#00c853; color:#000; }

  /* Loading animation */
  .loading {
    display:none;
    text-align:center;
    margin-top:20px;
  }
  .loading span {
    display:inline-block;
    font-size:22px;
    font-weight:bold;
    color:#00c853;
    animation: bounce 1.2s infinite;
  }
  .loading span:nth-child(2) { animation-delay:0.2s; }
  .loading span:nth-child(3) { animation-delay:0.4s; }
  .loading span:nth-child(4) { animation-delay:0.6s; }
  .loading span:nth-child(5) { animation-delay:0.8s; }
  .loading span:nth-child(6) { animation-delay:1s; }
  .loading span:nth-child(7) { animation-delay:1.2s; }

  @keyframes bounce {
    0%, 80%, 100% { transform: scale(0.8); opacity:0.5; }
    40% { transform: scale(1.3); opacity:1; }
  }

  /* Offline warning */
  .offline {
    background:#ff4c4c;
    padding:10px; border-radius:6px;
    margin-top:10px;
    text-align:center;
  }
</style>
</head>
<body>

<div class="container">
  <!-- Step 1 -->
  <div id="step1">
    <h2>Tell us about yourself</h2>
    <p>Already have a ZestPay account? <a href="/login" class="login-link">Login</a></p>
    <input type="text" id="firstName" placeholder="First Name" required>
    <input type="text" id="lastName" placeholder="Last Name" required>
    <input type="text" id="phone" placeholder="Phone Number" maxlength="11">
    <input type="text" id="referral" placeholder="Referral Code (Optional)">
    <button class="btn" onclick="nextStep()">Continue</button>
  </div>

  <!-- Step 2 -->
  <div id="step2" class="hidden">
    <h2>Set up your account</h2>
    <div id="messageBox"></div>
    <div class="input-container">
      <input type="email" id="email" placeholder="Email Address" required>
    </div>
    <div class="input-container">
      <input type="password" id="password" placeholder="Password (min 6 chars)">
      <span class="toggle-eye" onclick="togglePassword()">üëÅ</span>
      <div class="password-strength"><div id="strengthBar" class="strength-bar"></div></div>
    </div>
    <input type="password" id="confirmPassword" placeholder="Confirm Password">
    <button class="btn" onclick="registerAccount()">Create Account</button>
    <button class="btn btn-secondary" onclick="goBack()">Back</button>

    <!-- Loading Animation--> 
    <div class="loading" id="loading">
      <span>Z</span><span>E</span><span>S</span><span>T</span>
      <span>P</span><span>A</span><span>Y</span>
    </div>
  </div>
</div>

<script>
  function showMessage(msg, type="error") {
    const box = document.getElementById('messageBox');
    box.innerHTML = `<div class="message ${type==='error'?'error-msg':'success-msg'}">${msg}</div>`;
  }

  function nextStep() {
    const firstName = document.getElementById('firstName').value.trim();
    const lastName = document.getElementById('lastName').value.trim();
    const phone = document.getElementById('phone').value.trim();
    if(!firstName || !lastName || phone.length!==11) {
      alert("Please fill all required fields correctly.");
      return;
    }
    document.getElementById('step1').classList.add('hidden');
    document.getElementById('step2').classList.remove('hidden');
  }

  function goBack(){
    document.getElementById('step2').classList.add('hidden');
    document.getElementById('step1').classList.remove('hidden');
  }

  function togglePassword() {
    const pass = document.getElementById('password');
    pass.type = pass.type==='password'?'text':'password';
  }

  // password strength
  const password = document.getElementById('password');
  const strengthBar = document.getElementById('strengthBar');
  password.addEventListener('input', ()=>{
    const val = password.value;
    let strength=0;
    if(val.length>=6) strength++;
    if(/[A-Z]/.test(val)) strength++;
    if(/[0-9]/.test(val)) strength++;
    if(/[\W]/.test(val)) strength++;
    strengthBar.style.width = (strength*25)+'%';
    if(strength<=1) strengthBar.style.background='red';
    else if(strength==2) strengthBar.style.background='orange';
    else if(strength==3) strengthBar.style.background='yellow';
    else strengthBar.style.background='green';
  });

  async function registerAccount() {
    const email = document.getElementById('email').value.trim();
    const passwordVal = document.getElementById('password').value;
    const confirmPass = document.getElementById('confirmPassword').value;
    const loading = document.getElementById('loading');

    if(!email || passwordVal.length<6 || passwordVal!==confirmPass){
      showMessage("Please fill all fields correctly.", "error");
      return;
    }

    if(!navigator.onLine){
      showMessage("No Internet Connection", "error");
      return;
    }

    const firstName = document.getElementById('firstName').value;
    const lastName = document.getElementById('lastName').value;
    const phone = document.getElementById('phone').value;
    const referral = document.getElementById('referral').value;

    loading.style.display = "block"; // show animation

    try {
      const res = await fetch('/register', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({firstName,lastName,phone,referral,email,password:passwordVal})
      });
      const data = await res.json();

      loading.style.display = "none"; // hide loader

      if(data.status==='invalid_email'){
        showMessage("Invalid email address.", "error");
      } else if(data.status==='email_exists'){
        showMessage("This email is already registered.", "error");
      } else if(data.status==='phone_exists'){
        showMessage("They phone number is already used.", "error");
      } else if(data.status==='invalid_phone'){
        showMessage("Invalid phone number format.", "error");
      } else if(data.status==='ok'){
        showMessage("Account created successfully! Redirecting...", "success");
        setTimeout(()=>{ window.location.href="/login"; },2000);
      } else {
        showMessage("Unexpected error, please try again.", "error");
      }
    } catch(err){
      loading.style.display = "none";
      showMessage("Server error, please try again.", "error");
    }  
  }
</script>
</body>
</html> 
